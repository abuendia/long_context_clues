====> Done loading imports:  4.888115882873535 s
Loading data from local-scratch: `/local-scratch/nigam/hf_ehr/`.
{'main': {'seed': 1, 'path_to_output_dir': '/share/pi/nigam/mwornow/hf_ehr/cache/runs/${now:%Y-%m-%d_%H-%M-%S}/'}, 'callbacks': {'early_stopping': {'metric_mode': 'min', 'patience': 3}, 'model_checkpointing': {'save_top_k': 5, 'save_most_recent_k': 1, 'most_recent_every_n_train_steps': 1000, 'every_n_train_steps': 10000}}, 'data': {'dataset': {'path_to_femr_extract': '/local-scratch/nigam/hf_ehr/som-rit-phi-starr-prod.starr_omop_cdm5_deid_2023_08_13_extract_v9_lite'}, 'dataloader': {'batch_size': 4, 'n_workers': 1, 'max_length': 1024, 'is_truncation_random': True}, 'tokenizer': {'path_to_code_2_int': '/local-scratch/nigam/hf_ehr/code_2_int.json', 'path_to_code_2_count': '/local-scratch/nigam/hf_ehr/code_2_count.json', 'min_code_count': None}}, 'trainer': {'accumulate_grad_batches': 1, 'gradient_clip_value': 3, 'gradient_clip_algorithm': 'norm', 'devices': [0], 'distributed_backend': 'ddp', 'is_use_bf16': False, 'is_use_fp16': True, 'min_epochs': 1, 'max_epochs': 1, 'limit_train_batches': 50, 'limit_val_batches': 0, 'val_check_interval': 0.1, 'optimizer': {'lr': 0.0003}, 'scheduler': {'num_warmup_steps': 40000, 'num_decay_steps': 4000000, 'initial_lr': 3e-06, 'final_lr': 3e-05}}, 'logging': {'wandb': {'is_wandb': True, 'name': None}, 'mlflow': {'is_mlflow': False, 'name': None}, 'is_log_grad_norm': False, 'log_every_n_steps': 1}, 'model': {'name': 'gpt2', 'hf_name': 'gpt2', 'config_kwargs': {'n_layer': 12, 'n_head': 12, 'n_embd': 768}}}
[2024-04-02 01:54:17,430][wandb.util][WARNING] - Unable to read the token file at /var/run/secrets/kubernetes.io/serviceaccount/token due to permission error ([Errno 13] Permission denied: '/var/run/secrets/kubernetes.io/serviceaccount/token').The current user id is 1300068. Consider changing the securityContext to run the container as the current user.
[2024-04-02 01:54:24,244][torch.distributed.nn.jit.instantiator][INFO] - Created a temporary directory at /tmp/tmphrgvco0y
[2024-04-02 01:54:24,244][torch.distributed.nn.jit.instantiator][INFO] - Writing /tmp/tmphrgvco0y/_remote_module_non_scriptable.py
[2024-04-02 01:54:52,225][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2024-04-02 01:54:52,225][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
Training: |          | 0/? [00:00<?, ?it/s]Training:   0%|          | 0/50 [00:00<?, ?it/s]Epoch 0:   0%|          | 0/50 [00:00<?, ?it/s] Epoch 0:   2%|▏         | 1/50 [00:00<00:39,  1.25it/s]Epoch 0:   2%|▏         | 1/50 [00:00<00:39,  1.23it/s, v_num=rdci, train/loss=12.20][2024-04-02 01:55:54,875][torch.nn.parallel.distributed][INFO] - Reducer buckets have been rebuilt in this iteration.
Epoch 0:   4%|▍         | 2/50 [00:00<00:23,  2.07it/s, v_num=rdci, train/loss=12.20]Epoch 0:   4%|▍         | 2/50 [00:00<00:23,  2.03it/s, v_num=rdci, train/loss=12.00]Epoch 0:   6%|▌         | 3/50 [00:01<00:17,  2.63it/s, v_num=rdci, train/loss=12.00]Epoch 0:   6%|▌         | 3/50 [00:01<00:18,  2.60it/s, v_num=rdci, train/loss=12.10]Epoch 0:   8%|▊         | 4/50 [00:01<00:15,  3.06it/s, v_num=rdci, train/loss=12.10]Epoch 0:   8%|▊         | 4/50 [00:01<00:15,  3.02it/s, v_num=rdci, train/loss=12.00]Epoch 0:  10%|█         | 5/50 [00:01<00:13,  3.39it/s, v_num=rdci, train/loss=12.00]Epoch 0:  10%|█         | 5/50 [00:01<00:13,  3.35it/s, v_num=rdci, train/loss=12.00]Epoch 0:  12%|█▏        | 6/50 [00:01<00:11,  3.84it/s, v_num=rdci, train/loss=12.00]Epoch 0:  12%|█▏        | 6/50 [00:01<00:11,  3.80it/s, v_num=rdci, train/loss=11.80]Epoch 0:  14%|█▍        | 7/50 [00:01<00:10,  4.04it/s, v_num=rdci, train/loss=11.80]Epoch 0:  14%|█▍        | 7/50 [00:01<00:10,  4.00it/s, v_num=rdci, train/loss=11.90]Epoch 0:  16%|█▌        | 8/50 [00:01<00:09,  4.42it/s, v_num=rdci, train/loss=11.90]Epoch 0:  16%|█▌        | 8/50 [00:01<00:09,  4.38it/s, v_num=rdci, train/loss=11.90]Epoch 0:  18%|█▊        | 9/50 [00:01<00:09,  4.55it/s, v_num=rdci, train/loss=11.90]Epoch 0:  18%|█▊        | 9/50 [00:01<00:09,  4.51it/s, v_num=rdci, train/loss=11.80]Epoch 0:  20%|██        | 10/50 [00:02<00:08,  4.66it/s, v_num=rdci, train/loss=11.80]Epoch 0:  20%|██        | 10/50 [00:02<00:08,  4.62it/s, v_num=rdci, train/loss=11.80]Epoch 0:  22%|██▏       | 11/50 [00:02<00:08,  4.75it/s, v_num=rdci, train/loss=11.80]Epoch 0:  22%|██▏       | 11/50 [00:02<00:08,  4.71it/s, v_num=rdci, train/loss=11.70]Epoch 0:  24%|██▍       | 12/50 [00:02<00:07,  5.01it/s, v_num=rdci, train/loss=11.70]Epoch 0:  24%|██▍       | 12/50 [00:02<00:07,  4.98it/s, v_num=rdci, train/loss=11.60]Epoch 0:  26%|██▌       | 13/50 [00:02<00:07,  5.26it/s, v_num=rdci, train/loss=11.60]Epoch 0:  26%|██▌       | 13/50 [00:02<00:07,  5.22it/s, v_num=rdci, train/loss=11.70]Epoch 0:  28%|██▊       | 14/50 [00:02<00:06,  5.30it/s, v_num=rdci, train/loss=11.70]Epoch 0:  28%|██▊       | 14/50 [00:02<00:06,  5.27it/s, v_num=rdci, train/loss=11.80]Epoch 0:  30%|███       | 15/50 [00:02<00:06,  5.44it/s, v_num=rdci, train/loss=11.80]Epoch 0:  30%|███       | 15/50 [00:02<00:06,  5.40it/s, v_num=rdci, train/loss=11.80]Epoch 0:  32%|███▏      | 16/50 [00:02<00:06,  5.46it/s, v_num=rdci, train/loss=11.80]Epoch 0:  32%|███▏      | 16/50 [00:02<00:06,  5.43it/s, v_num=rdci, train/loss=11.70]Epoch 0:  34%|███▍      | 17/50 [00:03<00:05,  5.63it/s, v_num=rdci, train/loss=11.70]Epoch 0:  34%|███▍      | 17/50 [00:03<00:05,  5.60it/s, v_num=rdci, train/loss=11.60]Epoch 0:  36%|███▌      | 18/50 [00:03<00:05,  5.65it/s, v_num=rdci, train/loss=11.60]Epoch 0:  36%|███▌      | 18/50 [00:03<00:05,  5.62it/s, v_num=rdci, train/loss=11.40]Epoch 0:  38%|███▊      | 19/50 [00:03<00:05,  5.71it/s, v_num=rdci, train/loss=11.40]Epoch 0:  38%|███▊      | 19/50 [00:03<00:05,  5.69it/s, v_num=rdci, train/loss=11.50]Epoch 0:  40%|████      | 20/50 [00:03<00:05,  5.89it/s, v_num=rdci, train/loss=11.50]Epoch 0:  40%|████      | 20/50 [00:03<00:05,  5.86it/s, v_num=rdci, train/loss=11.40]Epoch 0:  42%|████▏     | 21/50 [00:03<00:04,  5.94it/s, v_num=rdci, train/loss=11.40]Epoch 0:  42%|████▏     | 21/50 [00:03<00:04,  5.92it/s, v_num=rdci, train/loss=11.40]Epoch 0:  44%|████▍     | 22/50 [00:03<00:04,  5.94it/s, v_num=rdci, train/loss=11.40]Epoch 0:  44%|████▍     | 22/50 [00:03<00:04,  5.91it/s, v_num=rdci, train/loss=11.60]Epoch 0:  46%|████▌     | 23/50 [00:03<00:04,  5.99it/s, v_num=rdci, train/loss=11.60]Epoch 0:  46%|████▌     | 23/50 [00:03<00:04,  5.97it/s, v_num=rdci, train/loss=11.30]Epoch 0:  48%|████▊     | 24/50 [00:04<00:04,  5.99it/s, v_num=rdci, train/loss=11.30]Epoch 0:  48%|████▊     | 24/50 [00:04<00:04,  5.96it/s, v_num=rdci, train/loss=11.50]Epoch 0:  50%|█████     | 25/50 [00:04<00:04,  5.98it/s, v_num=rdci, train/loss=11.50]Epoch 0:  50%|█████     | 25/50 [00:04<00:04,  5.96it/s, v_num=rdci, train/loss=11.00]Epoch 0:  52%|█████▏    | 26/50 [00:04<00:03,  6.12it/s, v_num=rdci, train/loss=11.00]Epoch 0:  52%|█████▏    | 26/50 [00:04<00:03,  6.09it/s, v_num=rdci, train/loss=11.30]Epoch 0:  54%|█████▍    | 27/50 [00:04<00:03,  6.11it/s, v_num=rdci, train/loss=11.30]Epoch 0:  54%|█████▍    | 27/50 [00:04<00:03,  6.08it/s, v_num=rdci, train/loss=11.20]Epoch 0:  56%|█████▌    | 28/50 [00:04<00:03,  6.10it/s, v_num=rdci, train/loss=11.20]Epoch 0:  56%|█████▌    | 28/50 [00:04<00:03,  6.07it/s, v_num=rdci, train/loss=11.00]Epoch 0:  58%|█████▊    | 29/50 [00:04<00:03,  6.21it/s, v_num=rdci, train/loss=11.00]Epoch 0:  58%|█████▊    | 29/50 [00:04<00:03,  6.19it/s, v_num=rdci, train/loss=11.00]Epoch 0:  60%|██████    | 30/50 [00:04<00:03,  6.20it/s, v_num=rdci, train/loss=11.00]Epoch 0:  60%|██████    | 30/50 [00:04<00:03,  6.18it/s, v_num=rdci, train/loss=11.60]Epoch 0:  62%|██████▏   | 31/50 [00:05<00:03,  6.19it/s, v_num=rdci, train/loss=11.60]Epoch 0:  62%|██████▏   | 31/50 [00:05<00:03,  6.16it/s, v_num=rdci, train/loss=11.60]Epoch 0:  64%|██████▍   | 32/50 [00:05<00:02,  6.17it/s, v_num=rdci, train/loss=11.60]Epoch 0:  64%|██████▍   | 32/50 [00:05<00:02,  6.15it/s, v_num=rdci, train/loss=11.10]Epoch 0:  66%|██████▌   | 33/50 [00:05<00:02,  6.16it/s, v_num=rdci, train/loss=11.10]Epoch 0:  66%|██████▌   | 33/50 [00:05<00:02,  6.14it/s, v_num=rdci, train/loss=10.80]Epoch 0:  68%|██████▊   | 34/50 [00:05<00:02,  6.15it/s, v_num=rdci, train/loss=10.80]Epoch 0:  68%|██████▊   | 34/50 [00:05<00:02,  6.13it/s, v_num=rdci, train/loss=11.60]Epoch 0:  70%|███████   | 35/50 [00:05<00:02,  6.22it/s, v_num=rdci, train/loss=11.60]Epoch 0:  70%|███████   | 35/50 [00:05<00:02,  6.21it/s, v_num=rdci, train/loss=11.20]Epoch 0:  72%|███████▏  | 36/50 [00:05<00:02,  6.21it/s, v_num=rdci, train/loss=11.20]Epoch 0:  72%|███████▏  | 36/50 [00:05<00:02,  6.19it/s, v_num=rdci, train/loss=11.40]Epoch 0:  74%|███████▍  | 37/50 [00:05<00:02,  6.20it/s, v_num=rdci, train/loss=11.40]Epoch 0:  74%|███████▍  | 37/50 [00:05<00:02,  6.18it/s, v_num=rdci, train/loss=11.10]Epoch 0:  76%|███████▌  | 38/50 [00:06<00:01,  6.19it/s, v_num=rdci, train/loss=11.10]Epoch 0:  76%|███████▌  | 38/50 [00:06<00:01,  6.17it/s, v_num=rdci, train/loss=11.10]Epoch 0:  78%|███████▊  | 39/50 [00:06<00:01,  6.18it/s, v_num=rdci, train/loss=11.10]Epoch 0:  78%|███████▊  | 39/50 [00:06<00:01,  6.16it/s, v_num=rdci, train/loss=11.20]Epoch 0:  80%|████████  | 40/50 [00:06<00:01,  6.17it/s, v_num=rdci, train/loss=11.20]Epoch 0:  80%|████████  | 40/50 [00:06<00:01,  6.15it/s, v_num=rdci, train/loss=11.60]Epoch 0:  82%|████████▏ | 41/50 [00:06<00:01,  6.16it/s, v_num=rdci, train/loss=11.60]Epoch 0:  82%|████████▏ | 41/50 [00:06<00:01,  6.14it/s, v_num=rdci, train/loss=11.30]Epoch 0:  84%|████████▍ | 42/50 [00:06<00:01,  6.15it/s, v_num=rdci, train/loss=11.30]Epoch 0:  84%|████████▍ | 42/50 [00:06<00:01,  6.13it/s, v_num=rdci, train/loss=11.30]Epoch 0:  86%|████████▌ | 43/50 [00:07<00:01,  6.14it/s, v_num=rdci, train/loss=11.30]Epoch 0:  86%|████████▌ | 43/50 [00:07<00:01,  6.12it/s, v_num=rdci, train/loss=10.90]Epoch 0:  88%|████████▊ | 44/50 [00:07<00:00,  6.21it/s, v_num=rdci, train/loss=10.90]Epoch 0:  88%|████████▊ | 44/50 [00:07<00:00,  6.20it/s, v_num=rdci, train/loss=10.70]Epoch 0:  90%|█████████ | 45/50 [00:07<00:00,  6.20it/s, v_num=rdci, train/loss=10.70]Epoch 0:  90%|█████████ | 45/50 [00:07<00:00,  6.19it/s, v_num=rdci, train/loss=11.00]Epoch 0:  92%|█████████▏| 46/50 [00:07<00:00,  6.28it/s, v_num=rdci, train/loss=11.00]Epoch 0:  92%|█████████▏| 46/50 [00:07<00:00,  6.27it/s, v_num=rdci, train/loss=10.90]Epoch 0:  94%|█████████▍| 47/50 [00:07<00:00,  6.27it/s, v_num=rdci, train/loss=10.90]Epoch 0:  94%|█████████▍| 47/50 [00:07<00:00,  6.25it/s, v_num=rdci, train/loss=11.60]Epoch 0:  96%|█████████▌| 48/50 [00:07<00:00,  6.26it/s, v_num=rdci, train/loss=11.60]Epoch 0:  96%|█████████▌| 48/50 [00:07<00:00,  6.24it/s, v_num=rdci, train/loss=11.20]Epoch 0:  98%|█████████▊| 49/50 [00:07<00:00,  6.32it/s, v_num=rdci, train/loss=11.20]Epoch 0:  98%|█████████▊| 49/50 [00:07<00:00,  6.31it/s, v_num=rdci, train/loss=11.30]Epoch 0: 100%|██████████| 50/50 [00:07<00:00,  6.31it/s, v_num=rdci, train/loss=11.30]Epoch 0: 100%|██████████| 50/50 [00:07<00:00,  6.30it/s, v_num=rdci, train/loss=11.20]Epoch 0: 100%|██████████| 50/50 [00:07<00:00,  6.29it/s, v_num=rdci, train/loss=11.20]Epoch 0: 100%|██████████| 50/50 [00:24<00:00,  2.05it/s, v_num=rdci, train/loss=11.20]
